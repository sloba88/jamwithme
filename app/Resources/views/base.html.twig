<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>{% block title %}Welcome!{% endblock %}</title>
    {% block stylesheets %}{% endblock %}
    <link rel="icon" type="image/x-icon" href="{{ asset('favicon.ico') }}" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="{{ asset('/css/bootstrap.css') }}" rel="stylesheet" media="screen">
    <link href="{{ asset('/css/select2.css') }}" rel="stylesheet"/>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
    <link href="{{ asset('/css/main.css') }}" rel="stylesheet"/>

    <!-- HTML5 Shim and Respond.js add IE8 support of HTML5 elements and media queries -->
    {% include 'BraincraftedBootstrapBundle::ie8-support.html.twig' %}

    <script src="https://cdn.socket.io/socket.io-1.0.4.js"></script>
    <script src="{{ node_server }}/socket.io/socket.io.js"></script>

    <script>
        baseURL = '{{ app.request.getBaseURL() }}';
        var socket = io('{{ node_server }}');

        {% if app.user %}
        socket.on('registerConnectedUser', function (data) {
            socket.emit('registerUserData', { userID: '{{ app.user.id }}', 'username': '{{ app.user.username }}' });
        });
        {% endif %}
    </script>

</head>
<body>

<!-- Fixed navbar -->
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand" href="{{ path('home') }}"><img src="{{ asset('images/logo.png') }}" alt="JamWithMee" /></a>
        </div>
        <ul class="nav navbar-nav navbar-left">
            <li {% if app.request.attributes.get('_route') == 'home' %}class="active"{% endif %}><a href="{{ path('home') }}"><span class="glyphicon glyphicon-home"></span></a></li>
            <li {% if app.request.attributes.get('_route') == 'musicians' %}class="active"{% endif %} ><a href="{{ path('musicians') }}">Musicians</a></li>
            <li {% if app.request.attributes.get('_route') == 'jams' %}class="active"{% endif %} style="text-decoration:line-through"><a href="{{ path('jams') }}">Jams</a></li>
            <li {% if app.request.attributes.get('_route') == 'start_jam' %}class="active"{% endif %} style="text-decoration:line-through"><a href="{{ path('start_jam') }}">Start a jam</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
            {% if is_granted("ROLE_USER") %}

                <li><a href="{{ path('musician_profile', {'username': app.user.username}) }}" class="user-box-image-link img-circle" style="padding:0; margin-right: 10px">
                        <img width="30" src="{{ path('musician_avatar', { 'username': app.user.username }) }}" class="" />
                    </a>
                </li>

                {#<li {% if app.request.attributes.get('_route') == 'notifications' %}class="active"{% endif %}><a href="&#123;&#35;{{ path('notifications') }}&#35;&#125;">Notifications</a></li>#}
                <li {% if app.request.attributes.get('_route') == 'inbox' %}class="active"{% endif %}><a href="{{ path('inbox') }}" id="messages-nav"><span class="glyphicon glyphicon-envelope"></span> <span class="badge"></span></a></li>
                <li {% if app.request.attributes.get('_route') == 'fos_user_profile_edit' %}class="active"{% endif %}><a href="{{ path('fos_user_profile_edit') }}"><span class="glyphicon glyphicon-cog"></span></a></li>
                <li {% if app.request.attributes.get('_route') == 'fos_user_security_logout' %}class="active"{% endif %}><a href="{{ path('fos_user_security_logout') }}"><span class="glyphicon glyphicon-off"></span></a></li>
            {% else %}
                <li {% if app.request.attributes.get('_route') == 'fos_user_security_login' %}class="active"{% endif %}><a href="{{ path('fos_user_security_login') }}">Login</a></li>
                <li {% if app.request.attributes.get('_route') == 'fos_user_registration_register' %}class="active"{% endif %}><a href="{{ path('fos_user_registration_register') }}">Register</a></li>
            {% endif %}
        </ul>
    </div>
</div>

<div class="container">

    {% if is_granted("ROLE_USER") %}
        {% if not app.user.location %}
            <div class="flash-message warning alert-warning">
                <em>Please <a href="{{ path('fos_user_profile_edit') }}">set your location</a> in order to be able to search people around you.</em>
            </div>
        {% endif %}
    {% endif %}

    {% for flashMessage in app.session.flashbag.get('success') %}
        <div class="flash-message alert alert-success">
            <em>{{ flashMessage }}</em>
        </div>
    {% endfor %}

    {% for flashMessage in app.session.flashbag.get('error') %}
        <div class="flash-message alert alert-danger">
            <em>{{ flashMessage }}</em>
        </div>
    {% endfor %}

    {% if is_granted("ROLE_USER") %}
        <div class="progress" style="">
            <div class="progress-bar" role="progressbar" aria-valuenow="{{ app.user.profileFulfilment }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ app.user.profileFulfilment }}%;">
                {{ app.user.profileFulfilment }}% Profile Completition
            </div>
        </div>
    {% endif %}

    {% block body %}{% endblock %}
    {% block fos_user_content %}
    {% endblock fos_user_content %}

</div>
<!-- jQuery (necessary for Bootstraps JavaScript plugins) -->
<!--<script src="https://code.jquery.com/jquery.js"></script>-->
<script src="{{ asset('/js/jquery.js') }}"></script>
<script src="{{ asset('/js/select2.min.js') }}"></script>
<!-- Include all JavaScripts, compiled by Assetic -->
<script src="{{ asset('/js/bootstrap.js') }}"></script>
<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script src="{{ asset('/js/vendor/bootstrap-typeahead.js') }}"></script>
<script src="{{ asset('/js/vendor/jquery-ui.min.js') }}"></script>
<script src="{{ asset('bundles/jamlocation/jquery.ui.addresspicker.js') }}"></script>
<script src="{{ asset('bundles/jamlocation/location.js') }}"></script>
<script src="{{ asset('js/vendor/underscore-min.js') }}"></script>
<script src="{{ asset('js/vendor/isotope.pkgd.min.js') }}"></script>
<script src="{{ asset('js/main.js') }}"></script>
<script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
<script src="{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}"></script>


<script type="text/template" id="messageTemplate">
    <% _.each( rc.messages, function( m ){ %>
    <% createdAt = new Date(m.createdAt); %>
    <p data-user="<%- m.to.username %>" data-user2="<%- m.from.username %>"><strong><i><%- m.from.username %></i></strong>: <%- m.message %>
        <span class="message-time"><%- createdAt.toLocaleDateString() %> <%- createdAt.toLocaleTimeString() %></span>
    </p>
    <% }); %>
</script>

<script type="text/template" id="musicianBoxTemplate">
    <div class="musician-box <% if(mu.teacher){ %>teacher<% } %>">
        <a href="{{ app.request.getBaseURL() }}/m/<%- mu.username %>" class="musician-box-image-link img-circle">
            <img src="{{ app.request.getBaseURL() }}/m/<%- mu.username %>/avatar" class="" width="50" />
        </a>
        <div class="musician-box-details">
            <a href="{{ app.request.getBaseURL() }}/m/<%- mu.username %>"><%- mu.username %></a> <br />
                <span class="musician-box-genres">
                    <% _.each( mu.genres, function(v, k){ %>
                        <% if (k!=0){ %>|<% } %>
                        <%- v %>
                    <% }); %>
                </span>
            <% if (mu.location) { %><span class="musician-box-location"><i class="glyphicon glyphicon-map-marker"></i> <%- mu.location %></span><% } %>
        </div>
    </div>
</script>

{% block javascripts %}{% endblock %}

<div class="modal fade" id="imageCropModalTemplate" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">Crop Photo</h4>
            </div>
            <div class="modal-body"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-sm cancel-crop" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-sm btn-primary" data-dismiss="modal">Save changes</button>
            </div>
        </div>
    </div>
</div>

<script type="text/template" id="imageTemplate">
    <div class="image-holder profile-media-wall-item">
        <img src="<%- rc.url %>" />
        <div class="profile-media-image-commands">
            <a href="#" class="remove-image"><span class="glyphicon glyphicon-remove-sign"></span></a>
            <a href="#" class="set-profile-photo" data-url="<%- rc.setAvatarUrl %>">Set as avatar</a>
        </div>
    </div>
</script>

<script></script>

</body>
</html>
