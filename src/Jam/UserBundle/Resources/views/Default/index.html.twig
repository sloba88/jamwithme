{% extends 'JamUserBundle::layout.html.twig' %}

{% block fos_user_content %}

    {#{{ user.getSoundcloudId() }}#}
    {% include "FOSUserBundle:Profile:show_content.html.twig" %}
{% endblock fos_user_content %}


{% block javascripts %}
    <link href="{{ asset('/css/jquery.Jcrop.min.css') }}" rel="stylesheet"/>
    <script src="/js/fileupload/vendor/jquery.ui.widget.js"></script>
    <!-- The Load Image plugin is included for the preview images and image resizing functionality -->
    <script src="/js/vendor/load-image.min.js"></script>
    <!-- The Canvas to Blob plugin is included for image resizing functionality -->
    <script src="/js/vendor/canvas-to-blob.min.js"></script>
    <!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
    <script src="/js/fileupload/jquery.iframe-transport.js"></script>
    <!-- The basic File Upload plugin -->
    <script src="/js/fileupload/jquery.fileupload.js"></script>
    <!-- The File Upload processing plugin -->
    <script src="/js/fileupload/jquery.fileupload-process.js"></script>
    <!-- The File Upload image preview & resize plugin -->
    <script src="/js/fileupload/jquery.fileupload-image.js"></script>
    <script src="/js/vendor/jquery.Jcrop.min.js"></script>
    <script src="/js/upload-photos.js"></script>

    <!-- Add mousewheel plugin (this is optional) -->
    <script type="text/javascript" src="/assets/fancy/jquery.mousewheel-3.0.6.pack.js"></script>
    <!-- Add fancyBox -->
    <link rel="stylesheet" href="/assets/fancy/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
    <script type="text/javascript" src="/assets/fancy/jquery.fancybox.pack.js?v=2.1.5"></script>

    <script>

        $(function() {

            SC.initialize({
                client_id: '3d3df354b405eee454308d224d8cfcbd',
                redirect_uri: Routing.generate('home')
            });

            $('a[data-tab="4"]').click(function(e){

                var userId = {{ app.request.get('username') }};
                var $this = $(e.currentTarget);

                SC.get("/tracks", {
                    user_id: userId,
                    limit: 100
                }, function (tracks) {

                    if(tracks.length > 0){
                        for(var i = 0; i < tracks.length; i++){
                            var track = tracks[i];

                            var iframe = $('<iframe />', {
                                id: 'iframe'+track.id,
                                width: '100%',
                                height: '166',
                                scrolling: 'no',
                                frameborder: 'no',
                                src: 'https://w.soundcloud.com/player/?url='+track.uri
                            });

                            $('div[data-tab="'+$this.attr('data-tab')+'"]').append(iframe);
                            SC.Widget(iframe[0]);
                        }
                    }

                });

            });

            {# TODO: similar nearby feature will be done later
            _.templateSettings.variable = "mu";
            var musicianBoxTemplate     = _.template($( "#musicianBoxTemplate" ).html());

            $.ajax({
                url: Routing.generate('musicians_similar'),
                data: "me={{ user.id }}"
            }).done(function( result ) {
                $.each(result.data, function(k, v){
                    $( ".similar-nearby-box" ).append(musicianBoxTemplate( v ) );
                });
            });
                #}
        });
    </script>

{% endblock %}